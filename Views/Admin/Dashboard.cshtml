@model MediScope.Models.ViewModels.AdminDashboardViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container py-4">

    <h2 class="fw-bold mb-4">
        <i class="bi bi-speedometer2"></i> Admin Dashboard
    </h2>

    <!-- Quick Stats Cards -->
    <div class="row g-3 mb-4">

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Total Doctors</h6>
                    <h2 id="totalDoctors" class="fw-bold">0</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Total Patients</h6>
                    <h2 id="totalPatients" class="fw-bold">0</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Total Appointments</h6>
                    <h2 id="totalAppointments" class="fw-bold">0</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Weekly Appointments</h6>
                    <h2 id="weeklyAppointments" class="fw-bold">0</h2>
                </div>
            </div>
        </div>

    </div>


    <!-- Charts Section -->
    <div class="row g-4">

        <!-- Weekly Appointments Chart -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-calendar-week"></i> Weekly Appointments (Chart)
                    </h5>
                    <canvas id="weeklyAppointmentsChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <!-- Doctor Ratings -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-star-half"></i> Doctor Ratings
                    </h5>
                    <canvas id="doctorRatingsChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <!-- Appointment Trends -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-graph-up"></i> Appointment Trends
                    </h5>
                    <canvas id="appointmentsChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <!-- Status Breakdown -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-pie-chart"></i> Appointment Status Breakdown
                    </h5>
                    <canvas id="statusChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <!-- Feedback Sentiment -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-emoji-smile"></i> Feedback Sentiment
                    </h5>
                    <canvas id="feedbackSentimentChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <!-- Average Rating -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="bi bi-bar-chart"></i> Average Feedback Rating
                    </h5>
                    <canvas id="ratingChart" height="150"></canvas>
                </div>
            </div>
        </div>

    </div>

</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ---------- TOTALS (Top Cards) ----------
        fetch('/api/admin/analytics/totalDoctors')
            .then(r => r.json())
            .then(data => { document.getElementById('totalDoctors').innerText = data.count; });

        fetch('/api/admin/analytics/totalPatients')
            .then(r => r.json())
            .then(data => { document.getElementById('totalPatients').innerText = data.count; });

        fetch('/api/admin/analytics/totalAppointments')
            .then(r => r.json())
            .then(data => { document.getElementById('totalAppointments').innerText = data.count; });

        fetch('/api/admin/analytics/weeklySummary')
            .then(r => r.json())
            .then(data => { document.getElementById('weeklyAppointments').innerText = data.count; });


        // ---------- WEEKLY APPOINTMENTS CHART ----------
        fetch('/api/admin/analytics/weeklyAppointments')
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('weeklyAppointmentsChart'), {
                    type: 'line',
                    data: {
                        labels: data.map(x => x.weekLabel),
                        datasets: [{
                            label: 'Weekly Appointments',
                            data: data.map(x => x.count),
                            borderColor: 'purple',
                            borderWidth: 2,
                            fill: false
                        }]
                    }
                });
            });


        // ---------- DOCTOR RATINGS ----------
        fetch('/api/admin/analytics/doctorRatings')
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('doctorRatingsChart'), {
                    type: 'bar',
                    data: {
                        labels: data.map(x => x.doctor),
                        datasets: [{
                            label: 'Avg Rating',
                            data: data.map(x => x.avgRating),
                            backgroundColor: '#ffa500'
                        }]
                    }
                });
            });


        // ---------- APPOINTMENT TRENDS ----------
        fetch('/api/admin/analytics/appointments')
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('appointmentsChart'), {
                    type: 'line',
                    data: {
                        labels: data.map(x => new Date(x.date).toLocaleDateString()),
                        datasets: [{
                            label: 'Appointments per Day',
                            data: data.map(x => x.value),
                            borderColor: 'blue',
                            borderWidth: 2,
                            fill: false
                        }]
                    }
                });
            });


        // ---------- STATUS BREAKDOWN ----------
        fetch('/api/admin/analytics/statusBreakdown')
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('statusChart'), {
                    type: 'pie',
                    data: {
                        labels: ['Scheduled', 'Completed', 'Cancelled'],
                        datasets: [{
                            data: [data.scheduled, data.completed, data.cancelled],
                            backgroundColor: ['#0d6efd', '#198754', '#dc3545']
                        }]
                    }
                });
            });


        // ---------- FEEDBACK SENTIMENT ----------
        fetch('/api/admin/analytics/feedbackSentiment')
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('feedbackSentimentChart'), {
                    type: 'pie',
                    data: {
                        labels: ['Positive', 'Neutral', 'Negative'],
                        datasets: [{
                            data: [data.positive, data.neutral, data.negative],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                        }]
                    }
                });
            });

        // ---------- AVERAGE RATING ----------
        fetch('/api/admin/analytics/ratings')
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('ratingChart'), {
                    type: 'bar',
                    data: {
                        labels: ['Average Rating'],
                        datasets: [{
                            label: 'Rating',
                            data: [data.average],
                            backgroundColor: ['#ffcc00']
                        }]
                    }
                });
            });
    </script>
}